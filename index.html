<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Hexpedition | Home</title>
    <link rel="stylesheet" href="./style.css" />
  </head>
  <body>
    <div id="chrome">
      <div id="map"></div>
      <div id="controls">
        <button type="button">(un)Lock</button>
        <button type="button" disabled>Scout</button>
      </div>
    </div>

    <script src="map.js"></script>
    <script src="lib.js"></script>
    <script src="queue.js"></script>
    <script src="render.js"></script>
    <script src="game-loop.js"></script>
    <script>
      // INSTANCE
      const HEX_MAP = {
        id: 1,
        mapId: 1,
        name: "SO FUCKING WHAT",
        mapHeight: 5,
        viewRadius: 1,
        mapData: hex,
        startHex: 21,
      };

      // The idea here is that entering a hex would change state and when state
      // is changed we'd know the ids of the updated hexes.
      // So we record them here so the render engine can change only the 7 updated hexes.
      // This assumes a view radius of 1. The diff would be different for a largeer view radius.
      const GAME_DATA = {
        MAP: HEX_MAP,
      };

      /**
       *
       * @param {number} radius
       * @param {number} mapHeight
       * @param {number} hexIndex
       * @param {number} mapLenth
       *
       * @returns {Array<number>}
       */
      function getSiblings(radius = 1, mapHeight, hexIndex, mapLength) {
        const { inRange } = window.hexplorer.lib;
        const siblings = [];

        const colNumber = Math.floor(hexIndex / mapHeight) + 1;
        const isEvenCol = colNumber % 2 === 0;

        // Sibling Hexes
        const top = hexIndex - 1;
        const bottom = hexIndex + 1;
        const left = hexIndex - mapHeight;
        const leftOther = left + (isEvenCol ? -1 : 1);
        const right = hexIndex + mapHeight;
        const rightOther = right + (isEvenCol ? -1 : 1);

        // Row Index
        const colFirstIndex = Math.floor(hexIndex / mapHeight) * mapHeight;
        const colLastIndex = colFirstIndex + mapHeight - 1;
        const prevColFirstIndex = Math.max(colFirstIndex - mapHeight, 0);
        const prevColLastIndex = Math.max(colLastIndex - mapHeight, 0);
        const nextColFirstIndex = Math.min(
          colFirstIndex + mapHeight,
          mapLength
        );
        const nextColLastIndex = Math.min(
          colLastIndex + mapHeight,
          mapLength - 1
        );

        // all imaginary indexes I haven't calculated or sourced yet
        if (top >= colFirstIndex) siblings.push(top);
        if (bottom <= colLastIndex) siblings.push(bottom);
        if (inRange(prevColFirstIndex, prevColLastIndex, left))
          siblings.push(left);
        if (inRange(prevColFirstIndex, prevColLastIndex, leftOther))
          siblings.push(leftOther);
        if (inRange(nextColFirstIndex, nextColLastIndex, right))
          siblings.push(right);
        if (inRange(nextColFirstIndex, nextColLastIndex, rightOther))
          siblings.push(rightOther);

        return siblings;
      }

      document.addEventListener("DOMContentLoaded", () => {
        const map = document.getElementById("map");

        map.addEventListener("click", (e) => {
          if (e.target.classList.contains("adjacent")) {
            window.hexplorer.queue.enqueue(e.target);
          }
        });

        hexplorer.render.renderAll(map, HEX_MAP.mapData, HEX_MAP.mapHeight);
      });
    </script>
  </body>
</html>
